<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>🔥 Firebase Connection Test</h1>
    
    <div id="status" class="status info">กำลังเชื่อมต่อ Firebase...</div>
    
    <div>
        <button onclick="testConnection()">🔍 Test Connection</button>
        <button onclick="testLEDOn()">💡 LED ON</button>
        <button onclick="testLEDOff()">💡 LED OFF</button>
        <button onclick="testFanOn()">🌪️ Fan ON</button>
        <button onclick="testFanOff()">🌪️ Fan OFF</button>
    </div>
    
    <h3>📊 Firebase Data:</h3>
    <pre id="data">กำลังโหลด...</pre>
    
    <h3>📝 Logs:</h3>
    <div id="logs"></div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDDJOzZOzNJoWmTNbHVGAL0-5KPQNcr8iY",
            authDomain: "fish-feeder-test-1.firebaseapp.com",
            databaseURL: "https://fish-feeder-test-1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "fish-feeder-test-1",
            storageBucket: "fish-feeder-test-1.firebasestorage.app",
            messagingSenderId: "965648166404",
            appId: "1:965648166404:web:9a8e0c5c8be5b2e4b5f9e8",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        function log(message) {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            logs.innerHTML += `<div>[${time}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // Listen to Firebase data
        const fishFeederRef = ref(database, 'fish_feeder');
        onValue(fishFeederRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                document.getElementById('data').textContent = JSON.stringify(data, null, 2);
                updateStatus('✅ เชื่อมต่อ Firebase สำเร็จ!', 'success');
                log('📡 ได้รับข้อมูลจาก Firebase');
            } else {
                updateStatus('⚠️ ไม่มีข้อมูลใน Firebase', 'error');
                log('❌ ไม่มีข้อมูลใน Firebase');
            }
        }, (error) => {
            updateStatus('❌ เชื่อมต่อ Firebase ล้มเหลว: ' + error.message, 'error');
            log('❌ Firebase Error: ' + error.message);
        });

        // Global functions for buttons
        window.testConnection = function() {
            log('🔍 ทดสอบการเชื่อมต่อ...');
            updateStatus('🔄 กำลังทดสอบ...', 'info');
        };

        window.testLEDOn = async function() {
            try {
                log('💡 ส่งคำสั่ง LED ON...');
                await set(ref(database, 'fish_feeder/control/led'), 'on');
                log('✅ LED ON สำเร็จ!');
            } catch (error) {
                log('❌ LED ON ล้มเหลว: ' + error.message);
            }
        };

        window.testLEDOff = async function() {
            try {
                log('💡 ส่งคำสั่ง LED OFF...');
                await set(ref(database, 'fish_feeder/control/led'), 'off');
                log('✅ LED OFF สำเร็จ!');
            } catch (error) {
                log('❌ LED OFF ล้มเหลว: ' + error.message);
            }
        };

        window.testFanOn = async function() {
            try {
                log('🌪️ ส่งคำสั่ง Fan ON...');
                await set(ref(database, 'fish_feeder/control/fan'), 'on');
                log('✅ Fan ON สำเร็จ!');
            } catch (error) {
                log('❌ Fan ON ล้มเหลว: ' + error.message);
            }
        };

        window.testFanOff = async function() {
            try {
                log('🌪️ ส่งคำสั่ง Fan OFF...');
                await set(ref(database, 'fish_feeder/control/fan'), 'off');
                log('✅ Fan OFF สำเร็จ!');
            } catch (error) {
                log('❌ Fan OFF ล้มเหลว: ' + error.message);
            }
        };

        log('🚀 Firebase Test เริ่มต้นแล้ว');
    </script>
</body>
</html> 